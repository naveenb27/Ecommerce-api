# Use the official OpenJDK image as the base image
FROM openjdk:17-jdk-slim

# Set the working directory
WORKDIR /app

# Copy the application JAR file into the container
COPY target/backend-0.0.1-SNAPSHOT.jar /app/backend.jar

# Set environment variables for MySQL, Elasticsearch, and OAuth
ENV SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/ECOMMERCE?autoReconnect=true&useSSL=false
ENV SPRING_DATASOURCE_USERNAME=root
ENV SPRING_DATASOURCE_PASSWORD=YOUR_PASSWORD
ENV SPRING_DATASOURCE_DRIVER_CLASS_NAME=com.mysql.cj.jdbc.Driver
ENV SPRING_JPA_HIBERNATE_DDL_AUTO=update
ENV SPRING_JPA_DATABASE_PLATFORM=org.hibernate.dialect.MySQL8Dialect
ENV SPRING_JPA_SHOW_SQL=true
ENV SPRING_JPA_PROPERTIES_HIBERNATE_FORMAT_SQL=true
ENV SPRING_DATASOURCE_HIKARI_CONNECTION_TIMEOUT=30000
ENV SPRING_DATASOURCE_HIKARI_IDLE_TIMEOUT=600000
ENV SPRING_DATASOURCE_HIKARI_MAX_LIFETIME=1800000
ENV SERVER_PORT=8080

# OAuth2 Configuration
ENV SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GITHUB_CLIENT_ID=U=YOUR_CLIENT_ID
ENV SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GITHUB_CLIENT_SECRET=YOUR_SECRET_CODE
ENV SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GITHUB_SCOPE=read:user,user:email
ENV SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GITHUB_REDIRECT_URI=http://localhost:8000/login/oauth2/code/github

ENV SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_ID=YOUR_CLIENT_ID
ENV SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_SECRET=YOUR_SECRET_CODE
ENV SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_SCOPE=profile,email
ENV SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_REDIRECT_URI=http://localhost:8000/login/oauth2/code/google

ENV FRONTEND_URL=http://localhost:5173

# JWT Secret
ENV JWT_SECRET=YOUR_SCRET_CODE

# Elasticsearch Configuration
ENV SPRING_ELASTICSEARCH_URIS=http://elasticsearch:9200
ENV SPRING_DATA_ELASTICSEARCH_REPOSITORIES_ENABLED=true

# Expose the port the app runs on
EXPOSE 8000

# Run the application
ENTRYPOINT ["java", "-jar", "/app/backend.jar"]
